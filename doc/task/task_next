# План дальнейшего развития Mediamtx Configuration Editor

**Дата:** 2025-10-23
**Версия:** 0.2.1 (обновлено с учетом анализа)

---

## Введение

Этот документ определяет следующие шаги по улучшению проекта после завершения Фазы 1 рефакторинга. Задачи сгруппированы по приоритетам для обеспечения итеративной и эффективной разработки.

---

## 1. Высокий приоритет (P1) - Следующий спринт

### 1.1. Улучшение UI/UX
- **Задача:** Реализовать темную тему с возможностью переключения.
- **Обоснование:** Повышает комфорт использования в условиях низкой освещенности и является стандартом для современных приложений.
- **Реализация:** Использовать `ui.dark_mode()` и добавить переключатель в заголовок.

- **Задача:** Добавить горячие клавиши.
- **Обоснование:** Ускоряет работу для опытных пользователей.
- **Реализация:**
    - `Ctrl+F` / `Cmd+F`: Фокус на поле поиска в "Paths".
    - `Ctrl+Enter` / `Cmd+Enter`: Сохранение в диалоговых окнах.

### 1.2. Функционал: Импорт и Экспорт
- **Задача:** Реализовать экспорт и импорт конфигурации.
- **Обоснование:** Позволяет пользователям делиться конфигурациями, создавать резервные копии и переносить настройки между серверами.
- **Реализация:**
    - Добавить кнопки "Экспорт" и "Импорт" в хедер.
    - **Экспорт:** Собирает текущую конфигурацию в `mediamtx.yml` и предлагает скачать файл.
    - **Импорт:** Позволяет загрузить `mediamtx.yml`, парсит его и обновляет данные в `MtxConfigManager` с последующим обновлением UI.
    - **(Новое)** **Обязательная валидация:** При импорте использовать Pydantic-модели для строгой проверки корректности структуры и типов данных загружаемого файла.

### 1.3. Качество кода и CI (Объединенный пункт)

- **Задача:** Написать docstrings для ключевых модулей и функций.
- **Обоснование:** Упрощает поддержку и дальнейшую разработку.
- **Реализация:**
    - Пройти по `mtx_manager.py`, `paths_tab.py`, `ui_utils.py` и добавить подробные docstrings в стиле Google.
    - Создать `CONTRIBUTING.md` (уже есть, проверить актуальность).

- **Задача (Новое):** Расширение покрытия тестами.
- **Обоснование:** Гарантирует стабильность основной логики при рефакторинге и добавлении нового функционала.
- **Реализация:**
    - Добавить тесты для `mtx_manager.py` (логика сохранения, загрузки, обновления).
    - Добавить базовые UI-тесты (smoke-tests) для `ui_components`, проверяющие рендеринг и основные взаимодействия.

- **Задача (Новое):** Очистка `.gitignore`.
- **Обоснование:** Предотвращает попадание в репозиторий файлов кэша, IDE и виртуальных окружений.
- **Реализация:**
    - Добавить в `.gitignore`: `__pycache__/`, `.pytest_cache/`, `.ruff_cache/`, `.venv/`, `.idea/` и другие специфичные для ОС/IDE файлы.

---

## 2. Средний приоритет (P2) - Ближайшее будущее

### 2.1. DevOps: CI/CD и Контейнеризация
- **Задача (Новое):** Настроить CI/CD пайплайн.
- **Обоснование:** Автоматизирует проверку качества кода и тестов, предотвращая попадание ошибок в основную ветку.
- **Реализация:**
    - Создать workflow для GitHub Actions (или аналога).
    - Добавить шаги для `ruff check .`, `ruff format --check .` и `pytest`.

- **Задача:** Создать `Dockerfile` и `docker-compose.yml`.
- **Обоснование:** Упрощает развертывание и обеспечивает консистентность окружения.
- **Реализация:**
    - `Dockerfile` на основе `python:3.12-slim`.
    - `docker-compose.yml` для запуска приложения и, опционально, самого `mediamtx`.

### 2.2. Функционал: Шаблоны потоков
- **Задача:** Реализовать создание потоков на основе шаблонов.
- **Обоснование:** Ускоряет добавление однотипных потоков (например, для одинаковых моделей камер).
- **Реализация:**
    - В диалоге добавления потока добавить выбор из списка сохраненных шаблонов.
    - Добавить кнопку "Сохранить как шаблон" в карточке потока.

### 2.3. Безопасность: Базовая аутентификация
- **Задача:** Добавить опциональную базовую аутентификацию.
- **Обоснование:** Защищает редактор от неавторизованного доступа.
- **Реализация:**
    - Использовать `app.add_middleware` с `BasicAuthMiddleware`.
    - Учетные данные (`ADMIN_USER`, `ADMIN_PASS`) должны задаваться через переменные окружения в `.env` файле.

### 2.4. Улучшение ядра (Новый пункт)
- **Задача (Новое):** Отслеживание внешних изменений файла.
- **Обоснование:** Предотвращает рассинхронизацию состояния, если `mediamtx.yml` был отредактирован вручную во время работы приложения.
- **Реализация:**
    - `MtxConfigManager` должен периодически (или по триггеру) проверять `mtime` файла конфигурации.
    - При обнаружении изменений показывать уведомление в UI с предложением перезагрузить конфигурацию.

### 2.5. Функционал: Интеграция с API Mediamtx (Новый пункт)
- **Задача (Новое):** Отображение живого статуса потоков.
- **Обоснование:** Предоставляет пользователю мгновенную обратную связь о состоянии потоков, делая приложение не просто редактором, а панелью мониторинга.
- **Реализация:**
    - Добавить в `core/config.py` настройки для доступа к API `mediamtx` (URL, токен).
    - В `paths_tab.py` для каждой карточки потока добавить индикатор статуса (online/offline), получаемый через API (`/v3/paths/list`).

---

## 3. Низкий приоритет (P3) - Долгосрочные цели

### 3.1. UI/UX: Продвинутые улучшения
- **Задача:** Drag-and-drop для сортировки потоков.
- **Обоснование:** Интуитивно понятный способ управления порядком потоков.
- **Задача:** Массовые действия (удаление/редактирование) для потоков.
- **Обоснование:** Повышает эффективность при работе с большим количеством потоков.

### 3.2. Функционал: История изменений
- **Задача:** Интеграция с Git для версионирования конфигурации.
- **Обоснование:** Позволяет отслеживать изменения и откатываться к предыдущим версиям `mediamtx.yml`.
- **Реализация:**
    - После сохранения автоматически создавать коммит в локальном Git-репозитории.
    - Добавить вкладку "История" для просмотра лога коммитов.

### 3.3. DevOps: Мониторинг и Зависимости
- **Задача:** Добавить эндпоинт для проверки состояния (`/health`).
- **Обоснование:** Необходимо для интеграции с системами мониторинга (Kubernetes, Prometheus).
- **Реализация:** Создать простой обработчик в `main.py`, который будет возвращать `{"status": "ok"}`.

- **Задача (Новое):** Унификация управления зависимостями.
- **Обоснование:** Упрощает управление проектом и CI/CD, устраняя дублирование.
- **Реализация:**
    - Перенести все зависимости из `requirements.txt` в `pyproject.toml` в секцию `[project.dependencies]`.
    - Обновить `Dockerfile` и CI для использования `uv pip install -e .`.

---

## Заключение

Этот план обеспечивает сбалансированное развитие проекта, охватывая как улучшение пользовательского опыта, так и повышение качества кода и надежности.